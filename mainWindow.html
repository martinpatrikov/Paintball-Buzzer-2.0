<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Scoreboard</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src = "main.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js'></script>
  </head>
  <body>
    <!-- audio inputs -->
    <div>
      <audio id="game-finished" controls style="display:none">
        <source src="/Paintball Buzzer/Scoreboard/assets/sounds/gameFinished.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      <audio id="60-seconds" controls style="display:none">
        <source src="/Paintball Buzzer/Scoreboard/assets/sounds/60secs.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      <audio id="10-seconds" controls style="display:none">
        <source src="/Paintball Buzzer/Scoreboard/assets/sounds/10secs.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      <audio id="30-seconds" controls style="display:none">
        <source src="/Paintball Buzzer/Scoreboard/assets/sounds/30secs.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>

    </div>
    <div id="top-part">
      <div class="first-team-container">
        <div class="team-score">
          <h1 class="title">TEAM A</h1>
          <div class="result-container">
            <div class="result first-team digits">00</div>
            <div class="result-commands">
              <button class="plus result result-button" id="first" value="+">+ </button>
              <button class="minus result result-button" id="first" value="-">-</button>
            </div>
          </div>
          <div class="current-side">Left</div>
        </div>        
        <div class="timeout-container">
          <button class="timeout">Timeout</button>
        </div>
      </div>


      <div class="timer-section">
        <div class="game-time">
          <h1 class="title">Game Time</h1>
          <div class="gametime-container">
            <div class="minutes">
              <button class="plus minutes big-time-button" value="+" id="first">+</button>
              <div class="minutes first-half digits time first-half-minutes" id="first-half-minutes"> 05 </div>
              <button class="minus minutes big-time-button" value="-" id="first" > - </button>
            </div>
            <div class="digits two-dots">
              <h1>:</h1>
            </div>
            <div class="seconds">
              <button class="plus seconds big-time-button" value="+" id="second"> + </button>
              <div class="seconds first-half digits time first-half-seconds" id="first-half-seconds"> 05 </div>
              <button class="minus seconds big-time-button" value="-" id="second"> - </button>
            </div>
            <div class="gametime-buttons">
              <button class="timer-buttons" onclick="startTimerTopHalf()">
                Start
              </button>
              <button class="timer-buttons" onclick="stopClock()">Stop</button>
              <button class="timer-buttons">Master Reset</button>
            </div>
          </div>
        </div>
        <div class="break-time">
          <h1 class="title">Break Time</h1>
          <div class="breaktime-container">
            <div class="minutes">
              <button class="plus minutes small-time-button" value="+" id="first"> + </button>
              <div class="minutes first-half digits time first-half-minutes-break" id="first-half-minutes-break"> 01 </div>
              <button class="minus minutes small-time-button" value="-" id="first"> - </button>
            </div>
            <div class="digits two-dots">
              <h1>:</h1>
            </div>
            <div class="seconds">
              <button class="plus seconds small-time-button" value="+" id="second"> + </button>
              <div class="seconds first-half digits time first-half-seconds-break" id="first-half-seconds-break"> 05 </div>
              <button class="minus seconds small-time-button" value="-" id="second" > - </button>
            </div>
            <div class="gametime-buttons">
              <button class="timer-buttons" onclick="startBreakTopHalf()">Start</button>
              <button class="timer-buttons" onclick="stopBreakClock()">Stop</button>
              <button class="timer-buttons">Master Reset</button>
            </div>
          </div>
        </div>
      </div>

      <div class="first-team-container">
        <div class="team-score">
          <h1 class="title">TEAM B</h1>
          <div class="result-container">
            <div class="result second-team digits">00</div>
            <div class="result-commands">
              <button class="plus result result-button" id="second" value="+"> + </button>
              <button class="minus result result-button" id="second" value="-"> - </button>
            </div>
          </div>
          <div class="current-side">Right</div>
        </div>
        <div class="timeout-container">
          <button class="timeout">Timeout</button>
        </div>
      </div>


    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
      // Arduino - Node connection
      var socket = io();

      socket.on('data', function(data) {
          
          console.log(data);
          
          document.getElementById('sample').style.opacity = data+"%"; 

      });



      $(".result-button").click(function () {
        let firstTeam = document.querySelector(".first-team");
        let secondTeam = document.querySelector(".second-team");
        let firstTeamCounter = document.querySelector(".first-team").textContent || 0;
        let secondTeamCounter = document.querySelector(".second-team").textContent || 0;
        let firedButtonTeam = $(this).attr("id");
        let firedButton = $(this).val();
        plusMinus(firedButton, firedButtonTeam, firstTeam, secondTeam, firstTeamCounter, secondTeamCounter, 1, 1);
      });

      // Timeout Button
      $(".timeout").click(function () {
        let minutesInTimer = document.getElementById("first-half-minutes-break");
        let min = document.getElementById("first-half-minutes-break").textContent || 0;
        
        min = parseInt(min);
        min++;
        if (min < 10) {
              min = "0" + min;
        }
        minutesInTimer.innerHTML = min;
        auxPause();
      });

      // Variables needed for GameTime for the top half
      let stoptime = true;

      // Timer Function
      function timerCycle() {
        let secondsInTimer = document.getElementById("first-half-seconds");
        let minutesInTimer = document.getElementById("first-half-minutes");
        let sec = document.getElementById("first-half-seconds").textContent || 0;
        let min = document.getElementById("first-half-minutes").textContent || 0;
        if (stoptime == false) {
          if(isNaN(min)){
            min = 0
          }
          sec = parseInt(sec);
          min = parseInt(min);
          if (sec <= 0) {
            if(sec < 0){
              sec = 0;
            }
            if (min <= 0) {
              if(min < 0){
                min = 0;
              }
              stoptime = true;
              let aux = document.getElementById('game-finished');
              aux.currentTime = 0;
              aux.play(); 
            } else {
              min--;
              sec = 60;
              stoptime = true;
              secondsInTimer.innerHTML = sec;
              minutesInTimer.innerHTML = min;
              startTimerTopHalf();
            }
          } else {
            sec--; 
            if (sec <= 0) {
              if(sec < 0){
                sec = 0;
              }
              if (min <= 0) {
                stoptime = true;
                let aux = document.getElementById('game-finished');
                aux.currentTime = 0;
                aux.play(); 
              } else {
                if(min < 0){
                  min = 0;
                }
                min--;
                sec = 59;
              }
            }

            if (min < 10) {
              min = "0" + min;
            }
            if (sec < 10) {
              sec = "0" + sec;
            }

            secondsInTimer.innerHTML = sec;
            minutesInTimer.innerHTML = min;
            setTimeout("timerCycle()", 1000);
          }
        }
      }

      // Game Timer Button Functions
      function startTimerTopHalf() {
        if (stoptime == true) {
          stoptime = false;
          timerCycle();
        }
      }

      function stopClock() {
        if (stoptime == false) {
          stoptime = true;
        }
      }

      // Break Timer
      let stoptimeBreak = true;
      let is10 = false;
      let is30 = false;
      let is60 = false;
      let aux60 = document.getElementById('60-seconds');
      let aux30 = document.getElementById('30-seconds');
      let aux10 = document.getElementById('10-seconds');
      // Timer Function
      function timerCycleBreak() {
        let secondsInTimer = document.getElementById("first-half-seconds-break");
        let minutesInTimer = document.getElementById("first-half-minutes-break");
        let sec = document.getElementById("first-half-seconds-break").textContent || 0;
        let min = document.getElementById("first-half-minutes-break").textContent || 0;
        if (stoptimeBreak == false) {
          sec = parseInt(sec);
          min = parseInt(min);
          if(isNaN(min)){
            min = 0
          }
          if (sec <= 0) {
            if(sec < 0){
              sec = 0;
            }
            if (min <= 0) {
              if(min < 0){
                min = 0;
              }
              stoptimeBreak = true;
            } else {
              stoptimeBreak = true;
              min--;
              sec = 60;
              secondsInTimer.innerHTML = sec;
              minutesInTimer.innerHTML = min;
              startBreakTopHalf();
            }
          } else {
            function sounds(){
              if(min == 1 && sec <= 0 || sec === 60){
                if(!is60){
                  aux60.currentTime = 0;
                  aux60.play();
                  is60 = true; 
                }
                
              }else if(min <= 0 && sec == 30){
                if(!is60 && !is30){
                  aux30.currentTime = 0;
                  aux30.play();
                  is30 = true;
                }
              }else if(min <= 0 && sec == 10){
                if(!is60 && !is30 && !is10){
                  aux10.currentTime = 0;
                  aux10.play();
                  is10 = true;  
                }
              }
            }
            sounds();
            sec--;
            sounds();
            if (sec <= 0) {
              if(sec < 0){
                sec = 0;
              }
              if (min <= 0) {
                stoptimeBreak = true;
                is10 = false;
                is30 = false;
                is60 = false;
                startTimerTopHalf();
              } else {
                if(min < 0){
                  min = 0;
                }
                min--;
                sec = 59;
              }
            }

            if (min < 10) {
              min = "0" + min;
            }
            if (sec < 10) {
              sec = "0" + sec;
            }

            secondsInTimer.innerHTML = sec;
            minutesInTimer.innerHTML = min;
            setTimeout("timerCycleBreak()", 1000);
          }
        }
      }

      // Break Timer Button Functions
      function startBreakTopHalf() {
        
        if (stoptimeBreak == true) {
          stoptimeBreak = false;
          timerCycleBreak();
        }
      }

      function stopBreakClock() {
        auxPause()
        if (stoptimeBreak == false) {
          stoptimeBreak = true;
        }
      }

      function auxPause(){
        aux10.pause();
        aux60.pause();
        aux30.pause();
        is10 = false;
        is30 = false;
        is60 = false;
      }
      

      // Game Time Buttons For Adjusting Time
      $(".big-time-button").click(function () {
        let firstGameTime = document.querySelector(".first-half-minutes");
        let secondGameTime = document.querySelector(".first-half-seconds");
        let seconds =  document.getElementById("first-half-seconds").textContent || 0;
        let minutes = document.getElementById("first-half-minutes").textContent || 0;
        let firedButtonTeam = $(this).attr("id");
        let firedButton = $(this).val();
        
        plusMinus(firedButton, firedButtonTeam, firstGameTime, secondGameTime, minutes, seconds, 1, 10);
      });
      $(".small-time-button").click(function () {
        let firstGameTime = document.querySelector(".first-half-minutes-break");
        let secondGameTime = document.querySelector(".first-half-seconds-break");
        let seconds =
          document.getElementById("first-half-seconds-break").textContent || 0;
        let minutes =
          document.getElementById("first-half-minutes-break").textContent || 0;
        let firedButtonTeam = $(this).attr("id");
        let firedButton = $(this).val();
        auxPause();
        plusMinus(firedButton, firedButtonTeam, firstGameTime, secondGameTime, minutes, seconds, 1, 10);
      });

      function plusMinus(firedButton, firedButtonTeam, firstHtml, secondHtml, textContent, textContent2, increment1, increment2) {
        increment1 = Number(increment1);
        increment2 = Number(increment2);
        textContent = Number(textContent);
        textContent2 = Number(textContent2);
        if (firedButton === "-") {
          if (firedButtonTeam === "first") {
            textContent -= increment1;
            if (textContent < 10 && textContent >= 0) {
              firstHtml.innerHTML = "0" + textContent;
            } else {
              firstHtml.innerHTML = textContent;
            }
          } else if (firedButtonTeam === "second") {
            textContent2 -= increment2;
            if (textContent2 < 10 && textContent2 >= 0) {
              secondHtml.innerHTML = "0" + textContent2;
            } else {
              secondHtml.innerHTML = textContent2;
            }
          }
        } else {
          if (firedButtonTeam === "first") {
            textContent += increment1;
            if (textContent < 10 && textContent >= 0) {
              firstHtml.innerHTML = "0" + textContent;
            } else {
              firstHtml.innerHTML = textContent;
            }
          } else if (firedButtonTeam === "second") {
            textContent2 += increment2;
            if (textContent2 < 10 && textContent2 >= 0) {
              secondHtml.innerHTML = "0" + textContent2;
            } else {
              secondHtml.innerHTML = textContent2;
            }
          }
        }
      }
    </script>
  </body>
</html>